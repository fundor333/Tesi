% !TEX encoding = UTF-8
% !TEX TS-program = pdflatex
% !TEX root = ../Tesi.tex
% !TEX spellcheck = it-IT

%************************************************
\chapter{Descrizione dell'argomento}
\label{cap:descrizione}
%************************************************
\section{Problema da risolvere} 
Lo scopo di questa tesi è quello di calcolare e visualizzare in modo corretto l'erosione del territorio nell'area geografica scelta. Come già accennato nell'introduzione, si puo' scegliere qualunque area georgrafica superiore a un metro quadro\footnote{Dimensione minima sotto la quale i file formato raster non possono andare}.

Il modello viene definito col nome RUSLE

Il problema puo' essere riassunto nell'equazione 
\begin{equation} \label{eq:main}
A = R * K * LS * C * P
\end{equation}

in cui
\begin{itemize}
	\item \textbf{A} corrispondente alla perdita di suolo annua
	\item \textbf{R} erosività delle precipitazioni
	\item \textbf{K} erodibilità del suolo
	\item \textbf{LS} rapporto tra la lunghezza e la pendenza
	\item \textbf{C} fattore di copertura del suolo
	\item \textbf{P} i parametri delle misure di prevenzione dell'erosione 
\end{itemize}

Tutti questi dati sono forniti sotto forma di file che vengono poi elaborati per ottenere il raster corrispondente alla perdita di suolo annuo. Fa eccezzione il parametro P, che puo' venire omesso e rimosso dall'equazione, visto che in caso non ci siano misure di prevenzione dell'erosione il valore corrispondente al punto della matrice corrisponde a 1.

\subsection{R o erosività delle precipitazioni}
Il parametro R rappresenta quanto le precipitazioni in una determinata area geografica. Viene fatto attraverso dati pluviometrici. Questi ultimi non sono dati con risoluzione temporale pari a un singolo evento meteorico ma da equazioni semplificate per ottenere il parametro da i dati di precipitazioni annue.

\begin{equation}\label{eq:r}
	R = \sum_{i=1}^{n} \frac{p_i}{n}
\end{equation}
In questa equazione 
\begin{itemize}
	\item \textit{n} corrisponde al numero di anni in cui si ha lo storico pluviometrico
	\item \textit{$p_i$} corrisponde alle precipitazioni dell'$i$-esimo anno.
\end{itemize}

Questo permette una approssimazione utilile per l'applicazione del modello RUSLE.

\subsection{K o erodibilità del suolo}
Il parametro K rappresenta quanto il terreno puo' essere eroso. Questo dipende molto da come  strutturato il terreno, dalla sua composizione geologica e da alcune caratteristiche fisiche e chimiche dello stesso.

Questo tipo di dato non è disponibile per aree geografiche di grosse dimensioni per cui è stata fatta una regrassione matematica su dati sulla tessitura del terreno dell'area interessata. Questo a permesso la creazione di un modello matematico descritto dall'equazione di Romkens che permette la creazione di una stima precisa (per quanto riguarda i nostri scopi) dell'erodibilità del suolo.

\begin{equation}\label{eq:k}
	K=0,0034 + 0,0405 * \exp{-0,5\left( \dfrac{(\log(D_g)+1,659)^2}{0,7101} \right) }
\end{equation}
In cui $D_g$ è il diametro medio pesato rispetto alla classi tessiturali dominanti in mm


\subsection{LS rapporto tra lunghezza e pendenza}
LS rappresenza un rapporto tra lunghezza e pendenza a meno di due parametri $m=0,4$ e $n=1,3$ definiti per convenzione. 
\begin{equation}\label{eq:ls}
	LS = \left(  \dfrac{A}{22,13} \right)^m
	\left(  \dfrac{\sin(\alpha)}{0,0896} \right)^n
\end{equation}

Che viene modificata nella \ref{eq:ls:edit} per ottenere una equazione che meglio rappresenti superfici con elevata complessità topografica e/o alta variabilità di pendenze.

\begin{equation}\label{eq:ls:edit}
LS=\left( \dfrac{flowacc * cellsize}{22,13}\right)^{04} \left( -1,5+\dfrac{17}{1+ e^{2,3-6,1*\sin{\alpha}}} \right) 
\end{equation}

In cui 
\begin{itemize}
	\item \textit{flowacc} corrisponde all' UCA  o numero di pixel tramite i quali l'acqua defluisce nell'area precisa di pixel
	\item \textit{cellsize} dimensione dei pixel
	\item \textit{$\alpha$} pendenza dell'area
\end{itemize}

\subsection{C o fattore di copertura del suolo}
Il fattore C è un rapporto tra la perdita di suolo in precise condizioni di copertura e la perdita di suolo nel caso il terreno sia privo di qualunque protezione.
Attualmente sono state fornite quarantaquattro classi di copertura di terreno con altrettanti valori del fattore C.

E' possibile anche utilizzare i dati provenienti da sensori di tipo AVHRR\footnote{Advance Very High Resolution Radiometer} con cui si calcola l'indice  NDVI\footnote{Normalized Difference Vegetation Index} che varia tra $1$ e $-1$

\begin{equation}\label{eq:c}
	C=\exp\left( -\alpha \dfrac{NDVI}{\beta -NDVI} \right) 
\end{equation}

\subsection{P o prevenzione dell'erosione}
Fattore rappresentante misure di controllo quali sistemi di drenaggio, terrazzamenti e sistemi specifici di coltivazione. 
Questo viene rappresentato sotto forma di un coefficiente a dimensionale compreso tra $0$ e $1$.

\section{Possibili risoluzioni}
La tesi \cite{tesi:ambientale} propone quattro sistemi per applicare e visualizzare l'applicazione del modello RUSTLE per l'area di terreno indicato.

Tutti questi sistemi per la visione e applicazione del modello RUSTLE sono stati vagliati e valutati secondo le nostre esigenze. Tutte questi sistemi hanno dei pregi e dei difetti e sono stati segnalati in base alle nostre necessità

\begin{itemize}
	
	\item \textit{Ripetibilità} il sistema scelto deve essere facilmente ripetibile.
	
	\item \textit{Veloce} il sistema scelto deve eseguire le operazioni per l'elaborazione e la visualizzazione deve rimanere in tempi ristretti anche se la mole di dati risulta enorme.
	
	\item \textit{Indipendente} il sistema scelto deve essere indipendente dal sistema operativo, in modo da poter essere utilizzato su qualunque dispositivo\footnote{Si considerano solo computer, i dispositivi mobili non sono \textit{espressamente} richiesti}.
	
	\item{Semplice} il sistema non deve avere pre-requisiti di competenze o capacità specifici in modo da permettere a teoreticamente chiunque di applicare il modello RUSLE.
	
	\item{Automatizzabile} il sistema scelto deve essere automatizzabile in modo da poterlo lanciare attraverso un sistema automatizzato senza la presenza costante di intervento umano.
	
	\item{Visuabilizzabile} il sistema deve avere un output dati facilmente leggibile per l'essere umano attraverso il sistema stesso o un software specifico.
	
\end{itemize}

\subsection{Software di grafic design}
Attraverso i classici programmi di creazione di ambienti virtuali è possibile visualizzare l'ambiente e le modifiche dell'ambiente in base ai dati raccolti. Questo permette di creare una rappresentazione realistica e molto dettagliata dell'ambiente preso in esame ma richiede una grossa quantità di tempo e notevoli sforzi, senza contare che necessità di un esperto di modellazione 3D che si occupi del lavoro.

\begin{itemize}
	\item{Visuabilizzabile} Molto facile da visualizzare e navigare. Questo risulta il migliore sistema esaminato per vedere gli effetti dell'erosione nel terreno preso in esame
	
	\item{Non ripetibile e complesso} Il sistema prevede che l'utente abbia una buona conoscenza di software di modellazione 3D e deve calcolare tutta l'erosione in modo autonomo.
	
	\item{Lento e non automatizzabile} Il sistema prevede la presenza di uno o più persone che sviluppino una mappa 3D. Anche l'utilizzo di una mappa 3D pre-esistente comunque porta il lavoro a tempi superiori a venti minuti e risulta infattibile senza la presenza della persona. 
\end{itemize}



\subsection{Programmazione}
Attraverso alcuni linguaggi di programmazione è possibile calcolare il raster di output. Per esempio è possibile farlo con Mathlab, R o Python con tempi di esecuzione diverso in base al linguaggio e a quanto è stato ottimizzato il codice che esegue queste operazioni. 

\begin{itemize}
	\item{Ripetibile e automatizzabile} Una volta realizzato il sistema è pronto per essere utilizzato in modo anche automatico.
	
	\item{Non indipendente} In base al linguaggio scelto e a come è stato compilato il programma è possibile che questo richieda dei prerequisiti, sotto forma di librerie di terze parti o macchine virtuali per il loro funzionamento, creando così molte dipendenze esterne non desiderabili.
	
	\item{Forse visuabilizzabile} La parte più difficile di questo sistema. Ci sono due strade possibili: l'utilizzo di un visualizzatore esterno a cui affidiamo il compito di visualizzare idati oppure sviluppiamo anche un sistema di visualizzazione personalizzato cercando di tenere al minimo le dipendenze con librerie di terze parti.
\end{itemize}

Questo sistema riesce a essere quello più adattabile alle nostre necessità ma rischia di diventare un accumulo di dipendenze esterne se sviluppato male.

\subsection{Desktop QGis}

Software che permette di visualizzare e elaborare raster e altri formati di file geomorfici. Molto usato e supporta, nativamente o attraverso plugin installabili, la quasi totalità dei formati di file esistenti. In oltre permette, attraverso codice python, c e c++, di estendere le funzionalità del programma stesso.

\begin{itemize}
	\item{Ripetibile} una volta scritto il plugin risulta riutibilizzabile semplicemente cambiando i dati.
	
	\item{Automatizzabile} Se scritto correttamente il plugin può effettuare la task assegnata in modo automatico ricevendo i dati da un altro processo.
	
	\item{Visuabilizzabile} QGis dispone di un intero motore di renderig integrato che permette di visualizzare i dati in modo semplice e, con l'aggiunta di plugin, è anche possibile applicare i dati su una mappa, mostrando in modo più efficace i dati georeferenziati.
	
	\item{Multipiattaforma} QGis è installabile sulla totalità dei desktop pc e su molti server. In oltre, se scritti correttamente, anche i plugin per QGis funzionano correttamente su tutte le piattaforme e alcuni tipi di server.
\end{itemize}

In oltre QGis risulta essere la prima scelta, come software, per l'analisi di dati geomorfici in ambito scientifico, per cui risulta naturale la scelta di sviluppare un plugin per questo applicativo.

\section{QGis}

QGis si definisce come "Un Sistema di Informazione Geografica Libero e Open Source"\cite{site:qgis} ovvero è un software che gestisce, elabora e visualizza dati geomorfici e georeferenziati, completamente gratuito e modificabile in ogni sua parte(è limitato dalla licenza utilizzata nello sviluppo del software \cite{site:cc3}).

Questo permette uno sviluppo continuo e slegato da esigenze commerciali evitando così obblighi di bilancio, rilasci effettuati solo per motivi di marcheting e dipendenze da ditte. Ogni individuo dotato di pc, connessione a internet e conoscenze di programmazione è in grado di aggiungere, rimuovere, migliorare funzionalità del programma e mandarle alla community. Quest'ultima dovrà quindi approvare le modifiche e applicarle al progetto e, così, dall'aggiornamento successivo, le modifiche saranno applicate su QGis.

Per questo progetto sono state utilizzate
\begin{itemize}
	\item \textit{Componenti di input e output} è possibile interfacciare il plugin scritto con il normale sistema di input/output di QGis ottenendo così un'interfaccia unica e coerente indipendentemente dal sistema operativo utilizzato.
	\item \textit{Sistema di supporto di formati di file} Collegandosi al sistema di supporto dei formati di file è possibile utilizzare tutti i formati supportati dall'installazione di QGis.
	\item \textit{Motore di calcolo} QGis comprende un pacchetto di operazioni standard sui file raster che sono utili per questo plugin.
	\item \textit{Sistema di rendering a video dei dati} Il sistema permette di visualizzare i file a schermo in versione grafica. Questo può essere fatto con l'output dei dati ottenuti dal plugin.
	\item \textit{Api di supporto per i plugin} Il sistema con cui si collega 
\end{itemize}


\subsection{Descrizione dei tipi di dati supportati}

Per risolvere il problema presentato è necessario passare al programma i dati. Sono devono essere già presenti all'interno dell'elaboratore o possono essere letti da un flusso in ingresso proveniente da sensori o da altri elaboratori.

Per il nostro problema i dati vengono forniti sotto forma di file o di database in quanto possono necessetira di una pre elaborazione e una formattazione, e di conseguenza non è conveniente l'utilizzo di un flusso. In oltre è possibile che i dati non vengano da un unico sensore in quanto sono dati legati a composizione geologica e a piogge in determinate aree e, di conseguenza, che necessitano di multipli sensori.


I formati di dati possono essere divisi in tre macrocategorie in base a come vengono forniti:
\begin{itemize}
	\item Vettoriali
	\item Raster
	\item DBRMS con estensione spaziale
\end{itemize}

Questi tre formati permettono solo alcune operazioni possibili legate alla composizione dei dati nel formato di input.
Quindi, per alcune operazioni, QGis converte i dati nell formato appropiato in modo che sia sempre possibile fare tutte le operazioni disponibili, anche se queste puo' portare ad approssimazioni dei dati nella conversione.

\subsection{La struttura di QGis}
QGis è un programma avanzato con molte funzionalità che possono essere suddivise in alcune macro-categorie che sono indipendenti dal tipo di dato o file utilizzato.
Le funzionalità standard di QGis sono gestite attraverso dei moduli che costituiscono l'istallazione di base del programma e le funzionalità aggiuntive vengono implementate attraverso plugin dipendenti da questi moduli di base per poter funzionare correttamente.
Solitamente i moduli sono scritti in C o C++ mentre i plugin e gli script sono in Python.

\subsubsection{Rendering grafico dei dati}
QGis ha la capacità di realizzare svariate visualizzazioni grafiche dei dati inseriti o calcolati.
Questo permette la realizzazioni di immagini ad alta definizione dei dati inseriti e ne permetta anche l'esportazione nei formati più comuni di immagini.

\subsubsection{Realizzazione mappe}
In presenza di dati georeferenziati QGis permette di sovrapporre la rappresentazione grafica dei dati alla mappa corrispondente alle coordinate georeferenziali.
Questo permette di creare mappe fisiche contenenti la visualizzazione di aree di erosione attraverso aree colorate o altri effetti applicabili alla mappa sottostante.

\subsubsection{Creazione, elaborazione e conversione dati}
QGis presenta due moduli per l'elaborazioni di dati:
\begin{itemize}
	\item \textbf{Class} modulo standard di QGis per i calcoli aritmetici elementari e alcuni calcoli statistici di base
	\item \textbf{Grass} modulo aggiuntivo di QGis per i calcoli avanzati e regressioni. Contiene anche modelli previsionali e probabilistici.
\end{itemize}

\subsubsection{Analisi dati}
Quando si lavora con un insieme di dati non è detto che questi siano tutti corretti o non abbiano un livello di approssimazione.
All'interno di QGis sono disponibili, di base, un insieme di funzionalità atte a calcolare la bontà delle approssimazioni o dei dati stessi presi in esame dal programma.
Questo viene fatto di base con algoritmi generici per la maggior parte dei formati ma se si usa solo un tipo specifico o si vuole una approssimazione o un modello preciso è possibile ottenere il risultato desiderato attraverso plugin di terze parti.

\subsection{Sistema dei plugin}
Per aumentare lel funzionalità di QGis e scriptare alcune operazioni sono stati creati i plugin.
Sono dei programmi dipendenti da QGis che implementano funzionalità non presenti nel programma di base o estendono il supporto delle funzioni esistenti o i tipi di file supportati.

\subsubsection{Plugin per formati di file}
Vengono utilizzati per elaborare dati grezzi altrimenti difficilmente manipolabili.
Un esempio possono essere i dati grezzi ottenuti da degli strumenti di misurazione con dati in output non standard.
Normalmente questi file sono leggibili solo col programma abilitato alle modifiche ma, con l'utilizzo del plugin corretto, è possibile leggerlo e elaborarlo direttamente in QGis.

\subsubsection{Pluing che alterano o aumentano le funzionalità}
La reale forza di QGis. Permettono di ampliare le funzioni del programma semplificando o aumentando le funzionalità pre esisteni. Alcuni esempi sono i plugin della famiglia GRASS che aggiungono operazioni matematiche o gli strumenti di creazione timelapse partendo da una serie di ruster temporizzati.s
